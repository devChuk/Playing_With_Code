function p(a){return Math.pow(a,2)}function sqrt(a){return Math.sqrt(a)}function map_range(a,b,c,d,e){return d+(e-d)*(a-b)/(c-b)}function reset(){this.scene=new THREE.Scene,setup()}function onWindowResize(){vw=window.innerWidth,vh=window.innerHeight,camera.aspect=vw/vh,camera.updateProjectionMatrix(),renderer.setSize(vw,vh),reset()}function projectToScreen(a){var b=a.clone(),c=document.documentElement.clientWidth,d=c/2,e=document.documentElement.clientHeight/2;return b.project(camera),b.x=b.x*d+d,b.y=-(b.y*e)+e,b.z=0,b}function distanceBetween(a,b){return sqrt(p(a.x-b.x)+p(a.y-b.y))}function genEdges(a,b){for(var c=0;c<vertices.length;c++)for(var d=c+1;d<vertices.length;d++){var e=distanceBetween(vertices[c],vertices[d]);e<a&&(b.globalAlpha=map_range(e,0,a,.5,0),b.beginPath(),b.moveTo(vertices[c].x,vertices[c].y),b.lineTo(vertices[d].x,vertices[d].y),b.strokeStyle="#ffffff",b.stroke())}}function genRanPtOutsideScreen(a){var b=2*(canvas.width+canvas.height),c=Math.random()*b;c<canvas.height&&c>0?a.push({x:Math.random()*-500,y:c}):c<canvas.height+canvas.width&&c>canvas.height?a.push({x:c-canvas.height,y:canvas.height+500*Math.random()}):c<2*canvas.height+canvas.width&&c>canvas.height+canvas.width?a.push({x:canvas.width+500*Math.random(),y:c-canvas.height-canvas.width}):a.push({x:c-2*canvas.height-canvas.width,y:Math.random()*-500})}function initMeshes(){var a=new THREE.JSONLoader,b=new THREE.SphereGeometry(300,15,15);sphereM=new THREE.Mesh(b);var c;c=canvas.width*canvas.height>55e4?500:256;for(var d=0;d<c;d++)starFieldM.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height}),starVelocities.push({dx:.4*Math.random()-.2,dy:.4*Math.random()-.2});a.load("./res/models/model2.json",function(a){stagBorderM=new THREE.Mesh(a),stagBorderM.scale.x=stagBorderM.scale.y=stagBorderM.scale.z=100})}function startTransition(a){switch(_goalPointsSatisfied=[],_distanceTravelled=[],a){case STAGE.STARFIELD:transitionSpeed=1,_goalPoints=[],_distanceTravelled=[];for(var b=0;b<250;b++)_goalPoints.push({x:starFieldM[b].x,y:starFieldM[b].y}),_distanceTravelled.push(0);if(vertices.length<starFieldM.length){vertices.length=250,_goalPoints.length=250;for(var b=250;b<500;b++)genRanPtOutsideScreen(vertices),_goalPoints.push({x:starFieldM[b].x,y:starFieldM[b].y}),_distanceTravelled.push(0)}break;case STAGE.STAG:transitionSpeed=.5,stagBorderM.updateMatrixWorld(),_goalPoints=[];for(var b=0;b<starFieldM.length;b++)b<stagBorderM.geometry.vertices.length?(_goalPoints.push(stagBorderM.geometry.vertices[b].clone()),_goalPoints[b].applyMatrix4(stagBorderM.matrixWorld),_goalPoints[b]=projectToScreen(_goalPoints[b])):genRanPtOutsideScreen(_goalPoints),_distanceTravelled.push(0)}for(var b=0;b<_goalPoints.length;b++)_goalPointsSatisfied.push(!1);_goalPoints.length<vertices.length&&(vertices.length=_goalPoints.length),_stage=STAGE.TRANSITION,_newStage=a,transitionTo(a,_goalPoints)}function transitionTo(a){var b=!0;_goalMovements=[],_speeds=[];for(var c=0;c<vertices.length;c++){var d=_goalPoints[c].x-vertices[c].x,e=_goalPoints[c].y-vertices[c].y,f=sqrt(p(d)+p(e)),g=_distanceTravelled[c]/(f+_distanceTravelled[c]),h=.3,i=.4,j=0;g<h?j=map_range(g,0,h,.5,20):g>=h&&g<=i?j=20:g>=i&&(j=map_range(g,i,1,20,5)),_goalMovements.push({dx:d/f*j,dy:e/f*j}),_distanceTravelled[c]+=j,_speeds.push(j)}for(var c=0;c<vertices.length;c++)0==_goalPointsSatisfied[c]?(b=!1,sqrt(p(_goalPoints[c].x-vertices[c].x)+p(_goalPoints[c].y-vertices[c].y))>_speeds[c]?(vertices[c].x+=_goalMovements[c].dx,vertices[c].y+=_goalMovements[c].dy):(_goalPointsSatisfied[c]=!0,vertices[c].x=_goalPoints[c].x,vertices[c].y=_goalPoints[c].y)):1==_goalPointsSatisfied[c]&&(vertices[c].x=_goalPoints[c].x,vertices[c].y=_goalPoints[c].y);b&&(_stage=a)}var vw=window.innerWidth,vh=window.innerHeight,scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,vw/vh,.1,1e3),modelCanvas=document.getElementById("3d"),renderer=new THREE.WebGLRenderer({antialias:!0,canvas:modelCanvas});camera.position.z=655;var closeEnough=130;opacityLvl=.05;var canvas,starCloseEnough,startTime,timeElapsed,STAGE={TRANSITION:0,SPHERE:1,STARFIELD:2,STAG:3},_stage=STAGE.SPHERE,vertices,_distanceTravelled,_goalPoints,_goalMovements,_goalPointsSatisfied,_speeds,_newStage,transitionSpeed=.5,sphereM,starFieldM=[],starVelocities=[],stagBorderM,stagEarM,stagEyeM,stagSnoutM,stagFadeM;window.addEventListener("resize",onWindowResize,!1);var setup=function(){renderer.setSize(vw,vh),container=document.createElement("div"),document.body.appendChild(container),scene.background=new THREE.Color(1776409),canvas=document.getElementById("2d"),canvas.width=vw,canvas.height=vh,stats=new Stats,container.appendChild(stats.dom),starFieldM=[],starVelocities=[],startTime=Date.parse(new Date),initMeshes()},render=function(){window.requestAnimationFrame(render),stats.update();var a=Date.now()-startTime;a>8e3&&_stage==STAGE.SPHERE?startTransition(STAGE.STARFIELD):a>18e3&&_stage==STAGE.STARFIELD&&startTransition(STAGE.STAG);var b=document.getElementById("2d"),c=b.getContext("2d");switch(c.clearRect(0,0,b.width,b.height),_stage){case STAGE.TRANSITION:switch(_newStage){case STAGE.STARFIELD:transitionSpeed+=.1;for(var d=0;d<starFieldM.length;d++)starFieldM[d].x+=starVelocities[d].dx,starFieldM[d].y+=starVelocities[d].dy,(starFieldM[d].x<0||starFieldM[d].x>b.width)&&(starVelocities[d].dx*=-1),(starFieldM[d].y<0||starFieldM[d].y>b.height)&&(starVelocities[d].dy*=-1),_goalPoints[d]=starFieldM[d];break;case STAGE.STAG:transitionSpeed+=.1,stagBorderM.updateMatrixWorld(),stagBorderM.rotation.x+=.01,stagBorderM.rotation.y+=.01;for(var d=0;d<stagBorderM.geometry.vertices.length;d++)_goalPoints[d]=stagBorderM.geometry.vertices[d].clone(),_goalPoints[d].applyMatrix4(stagBorderM.matrixWorld),_goalPoints[d]=projectToScreen(_goalPoints[d])}transitionTo(_newStage),genEdges(closeEnough,c);break;case STAGE.SPHERE:sphereM.updateMatrixWorld(),sphereM.rotation.x+=.001,sphereM.rotation.y+=.001,sphereM.rotation.z+=.001,vertices=[];for(var d=0;d<sphereM.geometry.vertices.length;d++)vertices.push(sphereM.geometry.vertices[d].clone()),vertices[d].applyMatrix4(sphereM.matrixWorld),vertices[d]=projectToScreen(vertices[d]);genEdges(closeEnough,c);break;case STAGE.STARFIELD:vertices=[];for(var d=0;d<starFieldM.length;d++)starFieldM[d].x+=starVelocities[d].dx,starFieldM[d].y+=starVelocities[d].dy,(starFieldM[d].x<0||starFieldM[d].x>b.width)&&(starVelocities[d].dx*=-1),(starFieldM[d].y<0||starFieldM[d].y>b.height)&&(starVelocities[d].dy*=-1),vertices.push(starFieldM[d]);genEdges(closeEnough,c);break;case STAGE.STAG:if(stagBorderM){stagBorderM.updateMatrixWorld(),stagBorderM.rotation.x+=.006,stagBorderM.rotation.y+=.006,vertices=[];for(var d=0;d<stagBorderM.geometry.vertices.length;d++)vertices.push(stagBorderM.geometry.vertices[d].clone()),vertices[d].applyMatrix4(stagBorderM.matrixWorld),vertices[d]=projectToScreen(vertices[d]);genEdges(closeEnough,c)}}renderer.render(scene,camera)};setup(),render();